<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Unit Converter</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eef2f6; /* Light blue-gray background */
            color: #333;
            display: flex;
            flex-direction: column; /* Changed to column to allow footer at bottom */
            justify-content: flex-start;
            align-items: center; /* Center content horizontally */
            min-height: 100vh;
            padding: 20px;
        }
        /* Style for input fields and selects */
        .input-field, .select-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db; /* Gray 300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .input-field:focus, .select-field:focus {
            outline: none;
            border-color: #6366f1; /* Indigo 500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Indigo 500 with opacity */
        }
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #6366f1; /* Indigo 500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="container mx-auto max-w-2xl bg-white p-6 md:p-8 rounded-xl shadow-lg">
        <!-- App Title -->
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-blue-800 mb-8">
            Universal Unit Converter
        </h1>

        <!-- Converter Section -->
        <section class="p-6 bg-blue-50 rounded-lg shadow-md space-y-6">
            <!-- Unit Type Selection -->
            <div>
                <label for="unitType" class="block text-sm font-medium text-gray-700 mb-1">Select Conversion Type:</label>
                <select id="unitType" class="select-field">
                    <option value="length">Length</option>
                    <option value="weight">Weight</option>
                    <option value="area">Area</option>
                    <option value="volume">Volume</option>
                    <option value="speed">Speed</option>
                    <option value="time">Time</option>
                    <option value="data">Digital Data</option>
                    <option value="pressure">Pressure</option>
                    <option value="energy">Energy</option>
                    <option value="power">Power</option>
                    <option value="frequency">Frequency</option>
                    <option value="temperature">Temperature</option>
                    <option value="currency">Currency</option>
                </select>
            </div>

            <!-- Input Value -->
            <div>
                <label for="inputValue" class="block text-sm font-medium text-gray-700 mb-1">Value to Convert:</label>
                <input type="number" id="inputValue" class="input-field" placeholder="Enter value" value="1" step="any" required>
            </div>

            <!-- From Unit Selection -->
            <div>
                <label for="fromUnit" class="block text-sm font-medium text-gray-700 mb-1">From Unit:</label>
                <select id="fromUnit" class="select-field"></select>
            </div>

            <!-- To Unit Selection -->
            <div>
                <label for="toUnit" class="block text-sm font-medium text-gray-700 mb-1">To Unit:</label>
                <select id="toUnit" class="select-field"></select>
            </div>

            <!-- Result Display -->
            <div class="bg-blue-100 p-4 rounded-md border border-blue-200 text-center">
                <p class="text-lg font-semibold text-blue-800">Result:</p>
                <div id="loadingSpinner" class="spinner mx-auto" style="display: none;"></div>
                <p id="resultDisplay" class="text-2xl font-bold text-blue-900 mt-1">0</p>
            </div>
        </section>
    </div>

    <!-- Footer with Version -->
    <footer class="mt-8 text-center text-gray-500 text-sm">
        <p>Version: 0.0.1</p>
    </footer>

    <script>
        // Define unit data for different types
        const units = {
            length: {
                meter: { name: 'Meter', toBase: 1 },
                kilometer: { name: 'Kilometer', toBase: 1000 },
                centimeter: { name: 'Centimeter', toBase: 0.01 },
                millimeter: { name: 'Millimeter', toBase: 0.001 },
                mile: { name: 'Mile', toBase: 1609.34 },
                yard: { name: 'Yard', toBase: 0.9144 },
                foot: { name: 'Foot', toBase: 0.3048 },
                inch: { name: 'Inch', toBase: 0.0254 }
            },
            weight: {
                kilogram: { name: 'Kilogram', toBase: 1 },
                gram: { name: 'Gram', toBase: 0.001 },
                milligram: { name: 'Milligram', toBase: 0.000001 },
                pound: { name: 'Pound', toBase: 0.453592 },
                ounce: { name: 'Ounce', toBase: 0.0283495 }
            },
            area: {
                square_meter: { name: 'Square Meter', toBase: 1 },
                square_kilometer: { name: 'Square Kilometer', toBase: 1_000_000 },
                square_centimeter: { name: 'Square Centimeter', toBase: 0.0001 },
                square_millimeter: { name: 'Square Millimeter', toBase: 0.000001 },
                square_mile: { name: 'Square Mile', toBase: 2_589_988.11 },
                square_yard: { name: 'Square Yard', toBase: 0.836127 },
                square_foot: { name: 'Square Foot', toBase: 0.092903 },
                square_inch: { name: 'Square Inch', toBase: 0.00064516 },
                hectare: { name: 'Hectare', toBase: 10_000 },
                acre: { name: 'Acre', toBase: 4046.86 }
            },
            volume: {
                cubic_meter: { name: 'Cubic Meter', toBase: 1 },
                liter: { name: 'Liter', toBase: 0.001 },
                milliliter: { name: 'Milliliter', toBase: 0.000001 },
                us_gallon: { name: 'US Gallon', toBase: 0.00378541 },
                imperial_gallon: { name: 'Imperial Gallon', toBase: 0.00454609 },
                cubic_foot: { name: 'Cubic Foot', toBase: 0.0283168 },
                cubic_inch: { name: 'Cubic Inch', toBase: 0.0000163871 }
            },
            speed: {
                meter_per_second: { name: 'Meter/Second', toBase: 1 },
                kilometer_per_hour: { name: 'Kilometer/Hour', toBase: 1 / 3.6 },
                mile_per_hour: { name: 'Mile/Hour', toBase: 0.44704 },
                foot_per_second: { name: 'Foot/Second', toBase: 0.3048 }
            },
            time: {
                second: { name: 'Second', toBase: 1 },
                minute: { name: 'Minute', toBase: 60 },
                hour: { name: 'Hour', toBase: 3600 },
                day: { name: 'Day', toBase: 86400 },
                week: { name: 'Week', toBase: 604800 },
                year: { name: 'Year (365 days)', toBase: 31536000 }
            },
            data: {
                byte: { name: 'Byte', toBase: 1 },
                kilobyte: { name: 'Kilobyte (KB)', toBase: 1024 },
                megabyte: { name: 'Megabyte (MB)', toBase: 1024 * 1024 },
                gigabyte: { name: 'Gigabyte (GB)', toBase: 1024 * 1024 * 1024 },
                terabyte: { name: 'Terabyte (TB)', toBase: 1024 * 1024 * 1024 * 1024 },
                bit: { name: 'Bit', toBase: 1 / 8 },
                kilobit: { name: 'Kilobit (Kb)', toBase: 1024 / 8 },
                megabit: { name: 'Megabit (Mb)', toBase: (1024 * 1024) / 8 },
                gigabit: { name: 'Gigabit (Gb)', toBase: (1024 * 1024 * 1024) / 8 }
            },
            pressure: {
                pascal: { name: 'Pascal (Pa)', toBase: 1 },
                kilopascal: { name: 'Kilopascal (kPa)', toBase: 1000 },
                megapascal: { name: 'Megapascal (MPa)', toBase: 1_000_000 },
                psi: { name: 'Pound-force/sq inch (psi)', toBase: 6894.76 },
                bar: { name: 'Bar', toBase: 100_000 },
                atmosphere: { name: 'Atmosphere (atm)', toBase: 101325 },
                mmHg: { name: 'Millimeter of Mercury (mmHg)', toBase: 133.322 }
            },
            energy: {
                joule: { name: 'Joule (J)', toBase: 1 },
                kilojoule: { name: 'Kilojoule (kJ)', toBase: 1000 },
                calorie: { name: 'Calorie (cal)', toBase: 4.184 },
                kilocalorie: { name: 'Kilocalorie (kcal)', toBase: 4184 },
                watt_hour: { name: 'Watt-hour (Wh)', toBase: 3600 },
                kilowatt_hour: { name: 'Kilowatt-hour (kWh)', toBase: 3_600_000 },
                electronvolt: { name: 'Electronvolt (eV)', toBase: 1.60218e-19 }
            },
            power: {
                watt: { name: 'Watt (W)', toBase: 1 },
                kilowatt: { name: 'Kilowatt (kW)', toBase: 1000 },
                megawatt: { name: 'Megawatt (MW)', toBase: 1_000_000 },
                horsepower: { name: 'Horsepower (hp)', toBase: 745.7 }
            },
            frequency: {
                hertz: { name: 'Hertz (Hz)', toBase: 1 },
                kilohertz: { name: 'Kilohertz (kHz)', toBase: 1000 },
                megahertz: { name: 'Megahertz (MHz)', toBase: 1_000_000 },
                gigahertz: { name: 'Gigahertz (GHz)', toBase: 1_000_000_000 }
            },
            temperature: {
                celsius: { name: 'Celsius', toBase: (val) => val, fromBase: (val) => val }, // Base is Celsius
                fahrenheit: { name: 'Fahrenheit', toBase: (val) => (val - 32) * 5/9, fromBase: (val) => (val * 9/5) + 32 },
                kelvin: { name: 'Kelvin', toBase: (val) => val - 273.15, fromBase: (val) => val + 273.15 }
            },
            currency: {
                // These will be populated dynamically after fetching from API
            }
        };

        // Global variable to store fetched exchange rates
        let exchangeRates = null;

        // Get references to HTML elements
        const unitTypeSelect = document.getElementById('unitType');
        const inputValueInput = document.getElementById('inputValue');
        const fromUnitSelect = document.getElementById('fromUnit');
        const toUnitSelect = document.getElementById('toUnit');
        const resultDisplay = document.getElementById('resultDisplay');
        const loadingSpinner = document.getElementById('loadingSpinner');

        /**
         * Fetches real-time exchange rates using the Gemini API.
         * Rates are relative to USD.
         */
        async function fetchExchangeRates() {
            loadingSpinner.style.display = 'block'; // Show spinner
            resultDisplay.textContent = 'Fetching rates...'; // Update text

            // Define the prompt for the Gemini API
            const prompt = "Provide current real-time exchange rates for major currencies (USD, EUR, JPY, GBP, CAD, AUD, CHF, CNY, PHP, SGD, HKD, KRW, THB, IDR, MYR, NZD) relative to USD as the base currency, in a JSON object. The keys should be the 3-letter currency codes and values should be their exchange rate against USD. For example: `{'USD': 1, 'EUR': 0.92, 'PHP': 58.50, ...}`. If you cannot provide real-time data, provide illustrative, plausible recent rates.";

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "USD": { "type": "NUMBER" },
                            "EUR": { "type": "NUMBER" },
                            "JPY": { "type": "NUMBER" },
                            "GBP": { "type": "NUMBER" },
                            "CAD": { "type": "NUMBER" },
                            "AUD": { "type": "NUMBER" },
                            "CHF": { "type": "NUMBER" },
                            "CNY": { "type": "NUMBER" },
                            "PHP": { "type": "NUMBER" },
                            "SGD": { "type": "NUMBER" },
                            "HKD": { "type": "NUMBER" },
                            "KRW": { "type": "NUMBER" },
                            "THB": { "type": "NUMBER" },
                            "IDR": { "type": "NUMBER" },
                            "MYR": { "type": "NUMBER" },
                            "NZD": { "type": "NUMBER" }
                        },
                        "additionalProperties": false // Only allow defined properties
                    }
                }
            };
            const apiKey = ""; // Leave as empty string, Canvas will provide it
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(jsonString);

                    // Store fetched rates
                    exchangeRates = parsedJson;

                    // Populate currency units based on fetched rates
                    units.currency = {}; // Clear previous currency definitions
                    for (const code in exchangeRates) {
                        units.currency[code] = { name: code, rate: exchangeRates[code] };
                    }
                    console.log("Fetched exchange rates:", exchangeRates);
                    populateUnitDropdowns(); // Re-populate dropdowns with new currency data
                } else {
                    console.error("Gemini API response structure unexpected:", result);
                    resultDisplay.textContent = 'Error fetching rates. Please try again.';
                }
            } catch (error) {
                console.error("Error fetching exchange rates:", error);
                resultDisplay.textContent = 'Failed to fetch rates. Network error or API issue.';
            } finally {
                loadingSpinner.style.display = 'none'; // Hide spinner
            }
        }

        /**
         * Populates the 'From Unit' and 'To Unit' dropdowns based on the selected unit type.
         */
        function populateUnitDropdowns() {
            const selectedType = unitTypeSelect.value;
            const currentTypeUnits = units[selectedType];

            // Clear existing options
            fromUnitSelect.innerHTML = '';
            toUnitSelect.innerHTML = '';

            // If currency is selected and rates haven't been fetched, display a message
            if (selectedType === 'currency' && !exchangeRates) {
                fromUnitSelect.innerHTML = '<option value="">Loading currencies...</option>';
                toUnitSelect.innerHTML = '<option value="">Loading currencies...</option>';
                fetchExchangeRates(); // Trigger fetch if not already done
                return;
            }

            // Add new options
            for (const unitKey in currentTypeUnits) {
                const option = document.createElement('option');
                option.value = unitKey;
                option.textContent = currentTypeUnits[unitKey].name;
                fromUnitSelect.appendChild(option);

                const optionClone = option.cloneNode(true);
                toUnitSelect.appendChild(optionClone);
            }

            // Set default selections if possible (e.g., first unit in list)
            if (fromUnitSelect.options.length > 0) {
                fromUnitSelect.value = Object.keys(currentTypeUnits)[0];
                toUnitSelect.value = Object.keys(currentTypeUnits)[1] || Object.keys(currentTypeUnits)[0]; // Select a different one if available
            }

            convertUnits(); // Perform initial conversion
        }

        /**
         * Performs the unit conversion and displays the result.
         */
        function convertUnits() {
            const selectedType = unitTypeSelect.value;
            const value = parseFloat(inputValueInput.value);
            const fromUnitKey = fromUnitSelect.value;
            const toUnitKey = toUnitSelect.value;

            // Handle invalid input
            if (isNaN(value)) {
                resultDisplay.textContent = 'Invalid Input';
                return;
            }

            const fromUnit = units[selectedType][fromUnitKey];
            const toUnit = units[selectedType][toUnitKey];

            // If units are not defined (e.g., currency rates not yet loaded)
            if (!fromUnit || !toUnit) {
                resultDisplay.textContent = 'Select units';
                return;
            }

            let convertedValue;

            if (selectedType === 'temperature') {
                // Temperature conversions are non-linear
                const valueInCelsius = fromUnit.toBase(value); // Convert input to base (Celsius)
                convertedValue = toUnit.fromBase(valueInCelsius); // Convert from base (Celsius) to target unit
            } else if (selectedType === 'currency') {
                // Currency conversions using fetched rates (all rates are relative to USD)
                if (!exchangeRates) {
                    resultDisplay.textContent = 'Rates not loaded.';
                    return;
                }

                const fromRate = exchangeRates[fromUnitKey];
                const toRate = exchangeRates[toUnitKey];

                if (!fromRate || !toRate) {
                    resultDisplay.textContent = 'Invalid currency selection.';
                    return;
                }

                // Convert from 'fromUnit' to USD, then from USD to 'toUnit'
                const valueInUSD = value / fromRate;
                convertedValue = valueInUSD * toRate;

            } else {
                // Linear conversions (length, weight, area, volume, speed, data, time, pressure, energy, power, frequency)
                const valueInBase = value * fromUnit.toBase;
                convertedValue = valueInBase / toUnit.toBase;
            }

            // Display result, rounded to a reasonable number of decimal places
            resultDisplay.textContent = convertedValue.toFixed(4); // Adjust precision as needed
        }

        // Event Listeners
        unitTypeSelect.addEventListener('change', populateUnitDropdowns);
        inputValueInput.addEventListener('input', convertUnits);
        fromUnitSelect.addEventListener('change', convertUnits);
        toUnitSelect.addEventListener('change', convertUnits);

        // Initial setup when the page loads
        window.onload = () => {
            populateUnitDropdowns(); // This will trigger fetchExchangeRates if currency is default
        };
    </script>
</body>
</html>
